/* Copyright (C) YOOtheme GmbH, YOOtheme Proprietary Use License (http://www.yootheme.com/license) */

jQuery(function(a){var b,e=widgetkitajax;a('select[name="settings[style]"]').bind("change",function(){a("#form").trigger("submit")});a("#finder").finder({url:e+"&task=dirs_gallery"}).delegate("a","click",function(){a("#finder li").removeClass("selected");b=a(this).parent().addClass("selected").data("path")});a("button.add-folder").bind("click",function(e){e.preventDefault();var d;a.each(a('#form input[name="paths[]"]').serializeArray(),function(a,c){c.value==b&&(d=true)});b&&!d&&a("#gallery").trigger("add",
[b])});a("#gallery").bind("add",function(b,d){var f=a(this),c=a('<div class="box"><div class="progress"></div><div class="deletable"></div><h3>'+d+'</h3><div class="content"></div></div>').appendTo(f).find(".content"),g=null,h=null,i=function(){c.children().remove();a.post(e+"&task=files_gallery",{path:d},function(b){a.each(b,function(a,b){c.append('<div class="file"><div class="image"><img src="'+f.data("url")+b.path+'" class="size-auto"/></div><div class="filename">'+b.name+'</div><input type="text" name="captions['+
b.path+']" placeholder="Enter caption here..." /><input type="text" name="links['+b.path+']" placeholder="Enter custom link here..." /></div>')});c.append('<input type="hidden" name="paths[]" value="'+d+'" />');a.support.ajaxupload&&c.append('<div class="dropinfo">Drop new images here to upload.</div>');a("input:text",f.trigger("update")).placeholder()},"json")};c.uploadOnDrag({action:e+"&task=upload_files_gallery",single:true,params:{path:d},loadstart:function(){g=c.find(".dropinfo");h=g.html('<div class="meter">&nbsp;</div>').find(".meter")},
progress:function(a){h.css("width",String(a)+"%").html(String(parseInt(a))+"%")},allcomplete:function(){i()}});i()});a("#gallery").delegate("#gallery > .box","delete",function(){a(this).fadeOut(300,function(){a(this).remove()})})});
